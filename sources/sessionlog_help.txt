Starting SessionLog
The Elekta Acquisition Software should be started before starting the SessionLog.  A new SessionLog should be started each time there is a change in the project or the subject.  

From the Acquisition Workspace on HP/UX megacq1, double click the SessionLog icon.

Data acquisition can now begin.  SessionLog monitors the megacq.log file generated by the Elekta Acquisition Software.  The Notes window is an editable text area for taking notes during the data recording.

Processes associated with saving data files will be displayed in the bottom Current Process window.

Notes Window
The Notes window is an editable text area for taking notes during the data recording.  

New Run
For each new recording (run), a New Run comment can be added by clicking the New Run button in the toolbar.  The following is an example of the text that is inserted at the current caret position.  Note that the run number will be incremented from the start of the session.  This number is editable.

--------------------------------------
***  2009-07-29 08:10:00 ***
RUN 1: 

Comment
Comment markers can be added by clicking the Comment button in the toolbar.  The following is an example of the text that is inserted at the current caret position:

> 08:11:00 Comment: 


Save
SessionLog automatically saves the text area to a backup log file (/neuromag/dacq/logs/sessionLog.txt) periodically during an open session.  When acquisition is complete, the user clicks the Acquisition Complete button in the toolbar and the sessionLog.txt is then saved to the current data collection folder (/MEG_data/project/subject/date).

If a sessionLog.txt file already exists in that folder, the user will be prompted to overwrite existing or append to existing.


Current Process Window
Processes associated with saving data files will be displayed in the bottom Current Process window.

When the user selects GO! from the Elekta Acquisition Software, this window is updated to inform the user so make selections to record data.

When a recording is saved, this window is updated to indicate MaxFilter is being performed on the recorded data.  The status of the MaxFilter analysis is also output to this window.



New Data Files Window
When a recording is saved, SessionLog updates the New Data Files window with the current data file storage folder (/MEG_data/project/subject/date).

This window displays the raw and averaged files, the corresponding sss files (once MaxFilter is complete), and the MaxFilter log file.


View Data Files
The user can view the contents of the files by clicking a file.  The system editor (emacs) will be opened and the selected file will appear in the editor.


Acquisition Complete
When the current session is complete, the user selects the Acquisition Complete button from the toolbar.

This will cause the SessionLog to stop monitoring the megacq.log file.  A new SessionLog will need to be started to begin monitoring acquisition again.

The text area is saved to sessionLog.txt in the location of the corresponding raw and averaged files and the SessionLog is closed.

If sessionLog.txt already exists in that location, the user can choose to overwrite the existing file or append the current text window to the end of the existing file.

Note:  If MaxFilter is running when Acquisition Complete is applied, the SessionLog will not close.  Closing it at this point will stop any processing that is happening in the background. 


MaxFilter
MaxFilter is started from SessionLog in a new thread on the megana1 HP/UX machine.  A public key is used to open the ssh session:

ssh meg@meganal


Automatic Processing
MaxFilter is automatically run on each file that is collected and saved while SessionLog is running.  Updates about the status of MaxFilter are output to the Current Process window. All files are processed with MaxFilter using the default options:

-f <input file>  
-o <output file> 
-ctc /neuro/databases/ctc/ct_sparse.fif 
-cal /neuro/databases/sss/sss_cal.dat 
-autobad off


Retrospective Processing
MaxFilter can be applied retrospectively to any files that have already been collected.  

The user can launch a batch run of MaxFilter by clicking the Run MaxFilter button on the toolbar.

The user will be prompted to select a folder.  All raw and averaged files in this folder will be processed with MaxFilter and a corresponding sss file and log file will be saved into the /sss folder of the selected folder.  If these corresponding files already exist, they will not be processed again.


cHPI
When continuous head positioning is used the following options are added to the MaxFilter processing:

-trans default 
-movcomp 
-hpistep 200 
-hpisubt amp 
-hp <output file>.pos


Troubleshooting

A log file is recorded when SessionLog is active.  Outputs of the processes are saved in this file.

/neuromag/dacq/logs/sessionlog.log

In the event that SessionLog stops responding, a copy of the text area is saved periodically to:

/neuromag/dacq/logs/sessionlog.txt

The SessionLog application (Java) should be killed and restarted.  This file can be loaded when the SessionLog is started again to resume the current data collection session.



